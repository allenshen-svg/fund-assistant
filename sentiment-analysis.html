<!DOCTYPE html>
<html lang="zh-CN">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width,initial-scale=1,maximum-scale=1,user-scalable=no">
<meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
<title>KOL vs 散户 · 情绪博弈</title>
<link rel="stylesheet" href="css/sentiment.css">
</head>
<body>

<!-- Loading Overlay -->
<div class="loading-overlay" id="loading-overlay">
  <div class="loading-icon">📡</div>
  <div class="loading-title">舆情逆向分析引擎</div>
  <div class="loading-sub">后端采集多平台数据，AI 情绪博弈分析中...</div>
  <div class="loading-bar"><div class="loading-fill" id="loading-fill" style="width:0%"></div></div>
  <div class="loading-status" id="loading-status">初始化...</div>
  <div class="loading-sources" id="loading-sources">
    <span class="loading-src" data-src="douyin">📱 抖音</span>
    <span class="loading-src" data-src="weibo">🐦 微博</span>
    <span class="loading-src" data-src="eastmoney">💹 东方财富</span>
    <span class="loading-src" data-src="tophub">🔥 聚合热榜</span>
    <span class="loading-src" data-src="ai">🧠 AI分析</span>
  </div>
</div>

<!-- Page Header (slim) -->
<div class="page-header">
  <div class="ph-row">
    <a class="ph-back" href="index.html">← 返回</a>
    <span class="ph-title">⚖️ KOL vs 散户 情绪博弈</span>
    <span class="ph-status"><span class="ph-dot" id="live-dot"></span> <span id="header-status">抓取中...</span></span>
  </div>
  <div class="ph-time" id="header-time"></div>
</div>

<!-- Main Content -->
<div id="main-content">

  <!-- Summary Card -->
  <div class="summary-card" id="summary-card">
    <div class="summary-signal">
      <div class="signal-icon" id="signal-icon">⏳</div>
      <div class="signal-text" id="signal-text">等待AI分析...</div>
    </div>
    <div class="summary-meta">
      <div class="meta-temp" id="meta-temp">🌡️ --</div>
      <div class="meta-radar" id="meta-radar">等待分析...</div>
    </div>
    <div class="summary-assets" id="summary-assets"></div>
  </div>

  <!-- Source Stats (compact pills) -->
  <div class="src-bar">
    <div class="src-pills">
      <span class="src-pill" id="src-douyin">抖音 <b>--</b></span>
      <span class="src-pill" id="src-weibo">微博 <b>--</b></span>
      <span class="src-pill" id="src-em">东财 <b>--</b></span>
      <span class="src-pill" id="src-cls">财联社 <b>--</b></span>
      <span class="src-pill" id="src-sina">新浪 <b>--</b></span>
      <span class="src-pill" id="src-zhihu">知乎 <b>--</b></span>
      <span class="src-pill" id="src-baidu">百度 <b>--</b></span>
      <span class="src-pill" id="src-bili">B站 <b>--</b></span>
    </div>
    <div class="src-total" id="total-badge">抓取中...</div>
  </div>

  <!-- Action Bar -->
  <div class="action-bar">
    <button class="btn-action secondary" onclick="toggleManual()">📝 补充数据</button>
    <button class="btn-action primary" id="btn-refresh" onclick="runFullPipeline()">🔄 重新分析</button>
  </div>
  <div class="manual-area" id="manual-area">
    <textarea id="manual-input" placeholder='可粘贴额外 JSON 数据数组，将合并分析...'></textarea>
  </div>
  <div class="progress-text" id="progress-text"></div>

  <!-- KOL vs 散户 博弈拆解 -->
  <div class="section" id="sec-hotspot">
    <div class="sec-header" onclick="toggleSection('hotspot-body')">
      <div class="sec-icon">⚖️</div>
      <div class="sec-title">KOL vs 散户 博弈拆解</div>
      <div class="sec-badge">预期差</div>
      <div class="sec-toggle" id="toggle-hotspot-body">▾</div>
    </div>
    <div class="sec-body" id="hotspot-body">
      <div class="placeholder">等待AI分析...</div>
    </div>
  </div>

  <!-- 热度雷达 -->
  <div class="section" id="sec-radar">
    <div class="sec-header" onclick="toggleSection('radar-body')">
      <div class="sec-icon">🔥</div>
      <div class="sec-title">热度雷达</div>
      <div class="sec-toggle" id="toggle-radar-body">▾</div>
    </div>
    <div class="sec-body" id="radar-body">
      <div class="heatbar" id="heatbar-chart"></div>
    </div>
  </div>

  <!-- 极简操作指南 -->
  <div class="section" id="sec-action">
    <div class="sec-header" onclick="toggleSection('action-body')">
      <div class="sec-icon">💡</div>
      <div class="sec-title">极简操作指南</div>
      <div class="sec-badge">反人性</div>
      <div class="sec-toggle" id="toggle-action-body">▾</div>
    </div>
    <div class="sec-body" id="action-body">
      <div class="placeholder">等待AI分析...</div>
    </div>
  </div>

  <!-- 原始数据流 (collapsed by default) -->
  <div class="section" id="sec-videos">
    <div class="sec-header" onclick="toggleSection('video-body')">
      <div class="sec-icon">📱</div>
      <div class="sec-title">原始数据流</div>
      <div class="sec-badge" id="video-count">0条</div>
      <div class="sec-toggle" id="toggle-video-body">▸</div>
    </div>
    <div class="sec-body collapsed" id="video-body" style="overflow-x:auto">
      <table class="video-table" id="video-table">
        <thead><tr><th>标题</th><th>热度</th><th>情绪</th><th>来源</th></tr></thead>
        <tbody id="video-tbody"></tbody>
      </table>
    </div>
  </div>

  <!-- AI 完整报告 (collapsed by default) -->
  <div class="section" id="sec-raw">
    <div class="sec-header" onclick="toggleSection('raw-body')">
      <div class="sec-icon">📋</div>
      <div class="sec-title">AI 完整报告</div>
      <div class="sec-toggle" id="toggle-raw-body">▸</div>
    </div>
    <div class="sec-body collapsed" id="raw-body">
      <div class="md-render" id="raw-report"><div class="placeholder">等待分析...</div></div>
    </div>
  </div>

</div>

<!-- Settings FAB -->
<button class="fab" onclick="openSettings()">⚙️</button>

<!-- Settings Modal -->
<div class="modal-overlay" id="settings-modal">
  <div class="modal">
    <h3>⚙️ AI 引擎设置 <button onclick="closeSettings()">✕</button></h3>
    <div class="form-row"><label>AI 服务商</label><select id="set-provider" onchange="onProviderChange()">
      <option value="siliconflow">硅基流动 (免费)</option>
      <option value="deepseek">DeepSeek 官方 (极低价)</option>
      <option value="302ai">302.AI (付费)</option>
    </select></div>
    <div class="form-row"><label>API Key</label><input type="password" id="set-apikey" placeholder="sk-xxxxxxxx"></div>
    <div class="form-row"><label>分析模型</label><select id="set-model"></select></div>
    <button class="form-btn" onclick="saveSettings()">保存设置</button>
  </div>
</div>

<!-- Footer -->
<div class="page-footer">
  数据来源：抖音 · 微博 · 东方财富 · 财联社 · 新浪财经 · 知乎 · B站 · 百度<br>
  本分析不构成投资建议 · <a href="index.html">返回基金小助理</a>
</div>

<script src="js/sa-config.js"></script>
<script src="js/sa-fetchers.js"></script>
<script src="js/sa-analysis.js"></script>
<script src="js/sa-render.js"></script>
<script src="js/sa-pipeline.js"></script>

</body>
</html>
