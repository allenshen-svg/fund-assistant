<view class="container">

  <!-- ====== Header ====== -->
  <view class="card header-card">
    <view class="row">
      <view class="header-left">
        <text class="header-title">ğŸ“Š åŸºé‡‘å†³ç­–åŠ©æ‰‹</text>
        <view class="header-meta">
          <view class="status-dot {{marketDot}}"></view>
          <text class="sub">{{marketStatus}}</text>
          <text class="sub" style="margin-left:12rpx;">{{currentTime}}</text>
        </view>
      </view>
      <text class="chip {{sourceLabel === 'è¿œç¨‹æ•°æ®' ? 'blue' : 'gray'}}">{{sourceLabel}}</text>
    </view>
  </view>

  <!-- ====== æŒ‡æ•°è¡Œæƒ… ====== -->
  <view class="idx-grid">
    <view class="idx-item" wx:for="{{indices}}" wx:key="code">
      <text class="idx-name">{{item.name}}</text>
      <text class="idx-price">{{item.price}}</text>
      <text class="idx-pct pct-{{item.pctClass}}">{{item.pctStr}}</text>
    </view>
    <view wx:if="{{indices.length === 0}}" class="idx-item" style="width:100%;">
      <text class="sub">è¡Œæƒ…åŠ è½½ä¸­...</text>
    </view>
  </view>

  <!-- ====== æŒä»“æ¦‚è§ˆ ====== -->
  <view class="card">
    <view class="card-header">
      <text class="title">ğŸ’¼ æŒä»“æ¦‚è§ˆ</text>
      <view class="row">
        <text class="total-pct pct-{{totalPctClass}}">{{totalPct}}</text>
        <text class="sub" style="margin-left:12rpx;">å‡å€¼</text>
      </view>
    </view>

    <view wx:if="{{holdings.length === 0 && !loading}}" class="empty-state">
      <text class="empty-icon">ğŸ“¦</text>
      <text class="sub">æš‚æ— æŒä»“</text>
      <button class="btn sm" style="margin-top:20rpx;" bindtap="goHoldings">å»æ·»åŠ </button>
    </view>

    <view class="holdings-grid" wx:if="{{holdings.length > 0}}">
      <view class="holding-card" wx:for="{{holdings}}" wx:key="code">
        <view class="row">
          <text class="h-name">{{item.name}}</text>
          <text class="h-pct pct-{{item.pctClass}}">{{item.pctStr}}</text>
        </view>
        <view class="row" style="margin-top:6rpx;">
          <text class="sub">{{item.code}} Â· {{item.type}}</text>
          <text class="sub" wx:if="{{item.estimate}}">ä¼°å€¼ {{item.estimate}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ====== è¡ŒåŠ¨æŒ‡å— ====== -->
  <view class="card">
    <view class="card-header">
      <text class="title">ğŸ¯ è¡ŒåŠ¨æŒ‡å—</text>
      <text class="chip {{overview.score >= 60 ? 'up' : overview.score <= 40 ? 'down' : 'gray'}}">
        {{overview.label}} Â· {{overview.score}}åˆ†
      </text>
    </view>
    <view class="overview-bar">
      <view class="ob-item red"><text class="ob-num">{{overview.buy}}</text><text class="ob-label">åŠ ä»“</text></view>
      <view class="ob-item green"><text class="ob-num">{{overview.sell}}</text><text class="ob-label">å‡ä»“</text></view>
      <view class="ob-item gray"><text class="ob-num">{{overview.hold}}</text><text class="ob-label">æŒæœ‰</text></view>
    </view>

    <view class="divider"></view>

    <view wx:if="{{plans.length === 0 && !loading}}" class="sub" style="text-align:center;padding:20rpx 0;">
      æ·»åŠ æŒä»“åå¯çœ‹ç ”åˆ¤å»ºè®®
    </view>

    <view class="plan-item" wx:for="{{plans}}" wx:key="code">
      <view class="row">
        <view>
          <text class="p-name">{{item.name}}</text>
          <text class="sub" style="margin-left:8rpx;">{{item.code}}</text>
        </view>
        <text class="chip {{item.action === 'buy' ? 'up' : item.action === 'sell' ? 'down' : 'gray'}}">
          {{item.actionLabel}}
        </text>
      </view>
      <view class="row" style="margin-top:8rpx;">
        <text class="sub">ğŸ”¥ {{item.tag}} Â· æ¸©åº¦{{item.temperature}} Â· {{item.trend === 'up' ? 'â†‘' : item.trend === 'down' ? 'â†“' : 'â†’'}}</text>
        <text class="sub {{item.riskScore >= 55 ? 'danger' : ''}}">âš ï¸ {{item.riskLevel}}</text>
      </view>
      <text class="reason">{{item.reason}}</text>
    </view>
  </view>

  <!-- ====== æ¿å—çƒ­åŠ› ====== -->
  <view class="card" wx:if="{{heatmap.length > 0}}">
    <view class="card-header">
      <text class="title">ğŸŒ¡ï¸ æ¿å—çƒ­åŠ›</text>
    </view>
    <view class="heat-grid">
      <view class="heat-chip" wx:for="{{heatmap}}" wx:key="tag"
            style="background:rgba({{item.temperature > 70 ? '239,68,68' : item.temperature > 50 ? '251,146,60' : '34,197,94'}}, {{item.temperature / 200}});">
        <text class="heat-tag">{{item.tag}}</text>
        <text class="heat-val">{{item.temperature}}Â°</text>
      </view>
    </view>
  </view>

  <!-- ====== çƒ­ç‚¹äº‹ä»¶ ====== -->
  <view class="card" wx:if="{{topEvents.length > 0}}">
    <view class="card-header">
      <text class="title">ğŸ“° çƒ­ç‚¹äº‹ä»¶</text>
      <text class="sub" bindtap="goSentiment">æ›´å¤š â€º</text>
    </view>
    <view class="event-item" wx:for="{{topEvents}}" wx:key="id">
      <view class="row">
        <text class="e-title">{{item.title}}</text>
        <text class="chip {{item.impactClass}}">{{item.impact >= 0 ? '+' : ''}}{{item.impact}}</text>
      </view>
      <text class="sub" style="margin-top:6rpx;">{{item.advice}}</text>
    </view>
  </view>

  <!-- ====== æ›´æ–°æ—¶é—´ ====== -->
  <view class="footer-info">
    <text class="sub">æ•°æ®æ›´æ–°ï¼š{{updatedAt}}</text>
  </view>

</view>
