<view class="container">

  <!-- ====== Loading ====== -->
  <view wx:if="{{loading}}" class="loading-wrap">
    <view class="loading-dot"></view>
    <text class="sub" style="margin-top:16rpx;">æ­£åœ¨åŠ è½½èˆ†æƒ…æ•°æ®...</text>
  </view>

  <!-- ====== æ€»è§ˆä¿¡å·å¡ ====== -->
  <view class="card summary-card" wx:if="{{!loading}}">
    <view class="summary-top">
      <view class="signal-box {{signalClass}}">
        <text class="signal-icon">{{signalIcon}}</text>
        <text class="signal-text">{{signalText}}</text>
      </view>
      <view class="temp-box {{tempClass}}">
        <text class="temp-val">{{marketTemp}}</text>
        <text class="temp-label">{{tempLabel}}</text>
      </view>
    </view>
    <text class="radar-summary" wx:if="{{radarSummary !== '--'}}">ğŸš¨ {{radarSummary}}</text>
    <!-- çƒ­é—¨èµ„äº§ -->
    <view class="hot-assets" wx:if="{{hotAssets.length > 0}}">
      <text class="asset-pill" wx:for="{{hotAssets}}" wx:key="name">ğŸ”¥ {{item.name}}</text>
    </view>
    <!-- æŒ‡æ ‡æ¡ -->
    <view class="gauge-row" wx:if="{{fomoLevel > 0 || panicLevel > 0}}">
      <view class="gauge-item">
        <text class="gauge-label">FOMO</text>
        <view class="gauge-bar-bg"><view class="gauge-bar fomo" style="width:{{fomoLevel}}%;"></view></view>
        <text class="gauge-val">{{fomoLevel}}</text>
      </view>
      <view class="gauge-item">
        <text class="gauge-label">ææ…Œ</text>
        <view class="gauge-bar-bg"><view class="gauge-bar panic" style="width:{{panicLevel}}%;"></view></view>
        <text class="gauge-val">{{panicLevel}}</text>
      </view>
      <view class="gauge-item">
        <text class="gauge-label">åˆ†æ­§</text>
        <view class="gauge-bar-bg"><view class="gauge-bar diverge" style="width:{{divergenceIndex}}%;"></view></view>
        <text class="gauge-val">{{divergenceIndex}}</text>
      </view>
    </view>
    <view class="summary-meta">
      <text class="chip {{sourceLabel === 'è¿œç¨‹åˆ†æ' ? 'blue' : 'gray'}}">{{sourceLabel}}</text>
      <text class="sub">æ›´æ–°ï¼š{{updatedAt}}</text>
    </view>
  </view>

  <!-- ====== æ•°æ®æºç»Ÿè®¡ ====== -->
  <scroll-view class="src-bar" scroll-x wx:if="{{sourcePills.length > 0}}">
    <view class="src-pill" wx:for="{{sourcePills}}" wx:key="name">
      <text class="src-name">{{item.short}}</text>
      <text class="src-count">{{item.count}}</text>
    </view>
    <view class="src-pill total">
      <text class="src-name">åˆè®¡</text>
      <text class="src-count">{{totalItems}}</text>
    </view>
  </scroll-view>

  <!-- ====== éš”å¤œç¾è‚¡ ====== -->
  <view class="card" wx:if="{{usStocks.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secUsMarket">
      <text class="title">ğŸ‡ºğŸ‡¸ éš”å¤œç¾è‚¡è¡Œæƒ…</text>
      <text class="toggle-icon">{{secUsMarket ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view class="us-grid" wx:if="{{secUsMarket}}">
      <view class="us-item" wx:for="{{usStocks}}" wx:key="symbol">
        <text class="us-name">{{item.name}}</text>
        <text class="us-price">{{item.price}}</text>
        <text class="us-pct {{item.pctClass}}">{{item.pctStr}}</text>
        <text class="us-amp">æŒ¯å¹… {{item.amplitude}}</text>
      </view>
    </view>
  </view>

  <!-- ====== KOL vs æ•£æˆ· åšå¼ˆæ‹†è§£ ====== -->
  <view class="card" wx:if="{{kolSections.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secKol">
      <text class="title">âš–ï¸ KOL vs æ•£æˆ· åšå¼ˆæ‹†è§£</text>
      <text class="toggle-icon">{{secKol ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view wx:if="{{secKol}}">
      <view class="kol-card {{item.divClass}}" wx:for="{{kolSections}}" wx:key="target">
        <text class="kol-target">ğŸ¯ {{item.target}}</text>
        <text class="kol-source-tag" wx:if="{{item.fromHeatmap}}">ğŸ“Š çƒ­åŠ›å›¾</text>
        <view class="kol-section">
          <text class="kol-label">ğŸ™ï¸ KOLè§‚ç‚¹</text>
          <text class="kol-body">{{item.kol}}</text>
        </view>
        <view class="kol-section">
          <text class="kol-label">ğŸ‘ æ•£æˆ·æƒ…ç»ª</text>
          <text class="kol-body">{{item.retail}}</text>
        </view>
        <view class="kol-section conclusion">
          <text class="kol-label">âš¡ é¢„æœŸå·®ç»“è®º</text>
          <text class="kol-body">{{item.conclusion}}</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ====== çƒ­åº¦é›·è¾¾ ====== -->
  <view class="card" wx:if="{{heatbars.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secHeatbar">
      <text class="title">ğŸ“Š çƒ­åº¦é›·è¾¾</text>
      <text class="toggle-icon">{{secHeatbar ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view class="heatbar-list" wx:if="{{secHeatbar}}">
      <view class="heatbar-row" wx:for="{{heatbars}}" wx:key="keyword">
        <text class="heatbar-kw">{{item.keyword}}</text>
        <view class="heatbar-track">
          <view class="heatbar-fill {{item.barClass}}" style="width:{{item.barWidth}}%;"></view>
        </view>
        <text class="heatbar-val">{{item.heatStr}}</text>
      </view>
    </view>
  </view>

  <!-- ====== æç®€æ“ä½œæŒ‡å— ====== -->
  <view class="card" wx:if="{{holdingActions.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secAction">
      <text class="title">ğŸ’¡ æç®€æ“ä½œæŒ‡å—</text>
      <text class="toggle-icon">{{secAction ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view wx:if="{{secAction}}">
      <!-- æŒä»“æ“ä½œ -->
      <view class="action-grid">
        <view class="action-item {{item.actClass}}" wx:for="{{holdingActions}}" wx:key="label">
          <text class="action-label">{{item.label}}</text>
          <text class="action-advice">{{item.advice}}</text>
        </view>
      </view>
      <!-- ç»¼åˆå»ºè®® -->
      <view class="action-summary">
        <view class="summary-line bullish" wx:if="{{bullish !== '--'}}">
          <text class="summary-icon">âœ…</text>
          <view class="summary-content">
            <text class="summary-head">èƒœç‡è¾ƒé«˜çš„æ–¹å‘</text>
            <text class="summary-body">{{bullish}}</text>
          </view>
        </view>
        <view class="summary-line bearish" wx:if="{{bearish !== '--'}}">
          <text class="summary-icon">âŒ</text>
          <view class="summary-content">
            <text class="summary-head">å¿…é¡»å›é¿çš„ç»è‚‰æœº</text>
            <text class="summary-body">{{bearish}}</text>
          </view>
        </view>
        <view class="summary-line tactical" wx:if="{{tactical !== '--'}}">
          <text class="summary-icon">â±ï¸</text>
          <view class="summary-content">
            <text class="summary-head">æˆ˜æœ¯çºªå¾‹</text>
            <text class="summary-body">{{tactical}}</text>
          </view>
        </view>
      </view>
    </view>
  </view>

  <!-- ====== æ¿å—çƒ­åŠ›å›¾ (åŸæœ‰) ====== -->
  <view class="card" wx:if="{{heatmap.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secHeatmap">
      <text class="title">ğŸŒ¡ï¸ æ¿å—çƒ­åŠ›å›¾</text>
      <text class="toggle-icon">{{secHeatmap ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view class="heat-list" wx:if="{{secHeatmap}}">
      <view class="heat-row" wx:for="{{heatmap}}" wx:key="tag">
        <view class="heat-info">
          <text class="heat-tag">{{item.tag}}</text>
          <text class="heat-trend {{item.trend === 'up' ? 'pct-up' : item.trend === 'down' ? 'pct-down' : 'pct-flat'}}">
            {{item.trendIcon}}
          </text>
        </view>
        <view class="heat-bar-wrap">
          <view class="heat-bar {{item.tempClass}}" style="width: {{item.temperature}}%;"></view>
        </view>
        <text class="heat-temp">{{item.temperature}}Â°</text>
      </view>
    </view>
  </view>

  <!-- ====== å¸‚åœºå±•æœ› (åŸæœ‰) ====== -->
  <view class="card" wx:if="{{outlook}}">
    <view class="card-header">
      <text class="title">ğŸ”® å¸‚åœºå±•æœ›</text>
      <text class="chip {{outlook.score >= 55 ? 'up' : outlook.score <= 45 ? 'down' : 'gray'}}">
        è¯„åˆ† {{outlook.score}}
      </text>
    </view>
    <text class="outlook-text">{{outlook.summary || outlook.narrative || '--'}}</text>
  </view>

  <!-- ====== åŸå§‹æ•°æ®æµ ====== -->
  <view class="card" wx:if="{{videoItems.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secVideos">
      <text class="title">ğŸ“± åŸå§‹æ•°æ®æµ</text>
      <text class="sub">{{videoItems.length}} æ¡</text>
      <text class="toggle-icon">{{secVideos ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view wx:if="{{secVideos}}">
      <view class="video-row {{item.isNoise ? 'noise' : ''}}" wx:for="{{videoItems}}" wx:key="index">
        <view class="video-main">
          <text class="video-title">{{item.title}}</text>
          <text class="video-likes">{{item.likes}}</text>
        </view>
        <view class="video-meta">
          <text class="sent-badge {{item.sentClass}}">{{item.sentiment}}</text>
          <text class="video-platform">{{item.platform}}</text>
          <text class="noise-tag" wx:if="{{item.isNoise}}">å™ªéŸ³</text>
        </view>
      </view>
    </view>
  </view>

  <!-- ====== AI å®Œæ•´æŠ¥å‘Š ====== -->
  <view class="card" wx:if="{{aiReport}}">
    <view class="card-header" bindtap="toggleSection" data-key="secReport">
      <text class="title">ğŸ¤– AI å®Œæ•´æŠ¥å‘Š</text>
      <text class="toggle-icon">{{secReport ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view class="ai-report" wx:if="{{secReport}}">
      <text class="ai-report-text">{{aiReport}}</text>
    </view>
  </view>

  <!-- ====== ç­›é€‰æ¡ (äº‹ä»¶) ====== -->
  <scroll-view class="filter-scroll" scroll-x wx:if="{{events.length > 0}}">
    <view class="filter-chip {{activeFilter === item.key ? 'active' : ''}}"
          wx:for="{{filters}}" wx:key="key"
          data-key="{{item.key}}" bindtap="onFilterTap">
      {{item.label}}
    </view>
  </scroll-view>

  <!-- ====== äº‹ä»¶åˆ—è¡¨ (åŸæœ‰) ====== -->
  <view class="card" wx:if="{{events.length > 0}}">
    <view class="card-header" bindtap="toggleSection" data-key="secEvents">
      <text class="title">ğŸ“° å¸‚åœºäº‹ä»¶</text>
      <text class="sub">å…± {{events.length}} æ¡</text>
      <text class="toggle-icon">{{secEvents ? 'â–¼' : 'â–¶'}}</text>
    </view>
    <view wx:if="{{secEvents}}">
      <block wx:for="{{events}}" wx:key="id">
        <view class="evt-item" wx:if="{{activeFilter === 'all' || (activeFilter === 'positive' && item.impact > 0) || (activeFilter === 'negative' && item.impact < 0) || item.category === activeFilter}}">
          <view class="row">
            <text class="evt-title">{{item.title}}</text>
            <text class="chip {{item.impactClass}}">{{item.impactStr}}</text>
          </view>
          <view class="evt-meta">
            <text class="chip gray" style="margin-right:8rpx;">{{item.category}}</text>
            <text class="sub">æƒ…ç»ª: {{item.sentimentLabel}}</text>
          </view>
          <text class="sub" wx:if="{{item.reason}}" style="margin-top:6rpx;">{{item.reason}}</text>
          <view class="evt-sectors" wx:if="{{item.sectorsPos !== '--'}}">
            <text class="sub pct-up">åˆ©å¥½ï¼š{{item.sectorsPos}}</text>
          </view>
          <view class="evt-sectors" wx:if="{{item.sectorsNeg !== '--'}}">
            <text class="sub pct-down">åˆ©ç©ºï¼š{{item.sectorsNeg}}</text>
          </view>
          <text class="sub" wx:if="{{item.advice}}" style="margin-top:6rpx;color:#6c8aff;">ğŸ’¡ {{item.advice}}</text>
        </view>
      </block>
    </view>
  </view>

  <!-- ====== ç©ºçŠ¶æ€ ====== -->
  <view wx:if="{{!loading && events.length === 0 && kolSections.length === 0}}" class="empty-state">
    <text class="empty-icon">ğŸ“­</text>
    <text class="sub">æš‚æ— èˆ†æƒ…æ•°æ®</text>
  </view>

  <!-- ====== Footer ====== -->
  <view class="footer" wx:if="{{!loading}}">
    <text class="sub">æ•°æ®æ¥æºï¼šæŠ–éŸ³/å¾®åš/ä¸œè´¢/çŸ¥ä¹/ç™¾åº¦/Bç«™/å°çº¢ä¹¦ + AIåˆ†æ</text>
    <text class="sub" style="margin-top:6rpx;">âš ï¸ æœ¬åˆ†æä¸æ„æˆæŠ•èµ„å»ºè®®</text>
  </view>

</view>
