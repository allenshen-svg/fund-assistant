<view class="container">

  <!-- ====== Header ====== -->
  <view class="card">
    <view class="card-header">
      <text class="title">ğŸ“¡ èˆ†æƒ…åˆ†æ</text>
      <text class="chip {{sourceLabel === 'è¿œç¨‹æ•°æ®' ? 'blue' : 'gray'}}">{{sourceLabel}}</text>
    </view>
    <text class="sub">æ›´æ–°ï¼š{{updatedAt}}</text>
  </view>

  <!-- ====== æ¿å—çƒ­åŠ›å›¾ ====== -->
  <view class="card" wx:if="{{heatmap.length > 0}}">
    <view class="card-header">
      <text class="title">ğŸŒ¡ï¸ æ¿å—çƒ­åŠ›å›¾</text>
    </view>
    <view class="heat-list">
      <view class="heat-row" wx:for="{{heatmap}}" wx:key="tag">
        <view class="heat-info">
          <text class="heat-tag">{{item.tag}}</text>
          <text class="heat-trend {{item.trend === 'up' ? 'pct-up' : item.trend === 'down' ? 'pct-down' : 'pct-flat'}}">
            {{item.trendIcon}}
          </text>
        </view>
        <view class="heat-bar-wrap">
          <view class="heat-bar {{item.tempClass}}" style="width: {{item.temperature}}%;"></view>
        </view>
        <text class="heat-temp">{{item.temperature}}Â°</text>
      </view>
    </view>
  </view>

  <!-- ====== å¸‚åœºå±•æœ› ====== -->
  <view class="card" wx:if="{{outlook}}">
    <view class="card-header">
      <text class="title">ğŸ”® å¸‚åœºå±•æœ›</text>
      <text class="chip {{outlook.score >= 55 ? 'up' : outlook.score <= 45 ? 'down' : 'gray'}}">
        è¯„åˆ† {{outlook.score}}
      </text>
    </view>
    <text class="outlook-text">{{outlook.summary || outlook.narrative || '--'}}</text>
  </view>

  <!-- ====== ç­›é€‰æ¡ ====== -->
  <scroll-view class="filter-scroll" scroll-x enable-flex>
    <view class="filter-chip {{activeFilter === item.key ? 'active' : ''}}"
          wx:for="{{filters}}" wx:key="key"
          data-key="{{item.key}}" bindtap="onFilterTap">
      {{item.label}}
    </view>
  </scroll-view>

  <!-- ====== äº‹ä»¶åˆ—è¡¨ ====== -->
  <view class="card" wx:if="{{events.length > 0}}">
    <view class="card-header">
      <text class="title">ğŸ“° å¸‚åœºäº‹ä»¶</text>
      <text class="sub">å…± {{events.length}} æ¡</text>
    </view>
    <block wx:for="{{events}}" wx:key="id">
      <view class="evt-item" wx:if="{{activeFilter === 'all' || (activeFilter === 'positive' && item.impact > 0) || (activeFilter === 'negative' && item.impact < 0) || item.category === activeFilter}}">
        <view class="row">
          <text class="evt-title">{{item.title}}</text>
          <text class="chip {{item.impactClass}}">{{item.impactStr}}</text>
        </view>
        <view class="evt-meta">
          <text class="chip gray" style="margin-right:8rpx;">{{item.category}}</text>
          <text class="sub">æƒ…ç»ª: {{item.sentimentLabel}}</text>
        </view>
        <text class="sub" wx:if="{{item.reason}}" style="margin-top:6rpx;">{{item.reason}}</text>
        <view class="evt-sectors" wx:if="{{item.sectorsPos !== '--'}}">
          <text class="sub pct-up">åˆ©å¥½ï¼š{{item.sectorsPos}}</text>
        </view>
        <view class="evt-sectors" wx:if="{{item.sectorsNeg !== '--'}}">
          <text class="sub pct-down">åˆ©ç©ºï¼š{{item.sectorsNeg}}</text>
        </view>
        <text class="sub" wx:if="{{item.advice}}" style="margin-top:6rpx;color:#6c8aff;">ğŸ’¡ {{item.advice}}</text>
      </view>
    </block>
  </view>

  <view wx:if="{{events.length === 0 && !loading}}" class="empty-state">
    <text class="empty-icon">ğŸ“­</text>
    <text class="sub">æš‚æ— äº‹ä»¶æ•°æ®</text>
  </view>

  <view wx:if="{{loading}}" class="loading-wrap">
    <view class="loading-dot"></view>
    <text class="sub" style="margin-top:16rpx;">åŠ è½½ä¸­...</text>
  </view>

</view>
